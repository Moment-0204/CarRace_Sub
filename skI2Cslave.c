/*******************************************************************************
 *  skI2Cslave - ？h？Q？b？？？M？？？s？？？X？？？[？u？p？？？？？？？？？C？u？？？？                     *
 *                                                                              *
 *    InterI2C         - ？h？Q？b？？？A？？？？？？？？？？？？？？(？？？？？？？？？？？？？？？？？？？？？M？？？？)   *
 *    InitI2C_Slave    - ？h？Q？b？？？M？？？X？？？[？u？？？[？h？？？？？？？？？？？s？？？？？？           *
 *    I2C_ReceiveCheck - ？}？X？^？[？？？？？？？？？M？？？？？？？`？F？b？N？？？？？？？？               *
 *                                                                              *
 *    ？？？？？FSDA/SCL？s？？？？？K？？？u？f？W？^？？？？？？？s？？？v？？？？？？？？？s？？？？？？？？？？？B         *
 *          ？？？？I2C？？？？？？？C？u？？？？？？？V？r？b？g？A？h？？？X？？？[？h？？？？？？？？？？？？？B         *
 * ============================================================================ *
 *  VERSION DATE        BY                    CHANGE/COMMENT                    *
 * ---------------------------------------------------------------------------- *
 *  1.00    2011-12-23  ？？？？？？？H？[(？？？？？？？？)  Create                            *
 * ============================================================================ *
 *  PIC 12F1822 16F1827                                                         *
 *  MPLAB IDE(V8.63)                                                            *
 *  HI-TECH C Compiler for PIC10/12/16 MCUs Version 9.80 in Lite mode           *
 *******************************************************************************/
#include <pic.h>
#include "skI2Cslave.h"       // I2C？？？？？？？C？u？？？？？[？p


/*******************************************************************************
 *  interrupt InterI2C( void )                                                  *
 *    ？h？Q？b？？？A？？？？？？？？？？？？？？                                                  *
 *******************************************************************************/


/*******************************************************************************
 *  InitI2C_Slave(address)                                                      *
 *    ？h？Q？b？？？M？？？X？？？[？u？？？[？h？？？？？？？？？？？s？？？？？？                              *
 *     ？？？？？？？？？o？？？？？？？？？？？m？？？？？？？？？？？？？？？？？？？？？？？？？？？B                       *
 *                                                                              *
 *    address : ？X？？？[？u？？？}？C？A？h？？？X？？？？？？？？？？(？W？`？P？P？X？？？？？？)              *
 *******************************************************************************/
void InitI2C_Slave(int address) {
    SSPSTAT = 0b10000000; // ？W？？？？？x？？？[？h？？？？？？？？？？(100kHz)
    SSPCON1 = 0b00100110; // SDA/SCL？s？？？？I2C？？？g？p？？？A？X？？？[？u？？？[？h？？？？？？
    SSPCON2bits.SEN = 1; // SCL？？？？(？N？？？b？N？X？g？？？b？`)？？？s？？
    //   SSP1CON2bits.GCEN = 1;   // ？？？？？？？？？o？？？？？？？？？？？m？？？L？？？？？？？？
    SSPADD = address << 1; // ？}？C？A？h？？？X？？？？？？
    SSPMSK = 0b11111110; // ？A？h？？？X？？？r？p？}？X？N？f？[？^
    SSPIE = 1; // SSP(I2C)？？？？？？？？？？？？？？？？？？
    BCLIE = 1; // MSSP(I2C)？o？X？？？？？？？？？？？？？？？？？？？？？？
    PEIE = 1; // ？？？？？？？u？？？？？？？？？？？？？？？？？？
    GIE = 1; // ？S？？？？？？？？？？？？？？？？？？？？？？ 
    SSPIF = 0; // SSP(I2C)？？？？？？？？？t？？？O？？？N？？？A？？？？
    BCLIF = 0; // MSSP(I2C)？o？X？？？？？？？？？？？？？t？？？O？？？N？？？A？？？？
    rcv_flg = 0;
}

/*******************************************************************************
 *  ans = I2C_ReceiveCheck()                                                    *
 *    ？}？X？^？[？？？？？？？？？M？？？？？？？`？F？b？N？？？？？？？？                                  *
 *                                                                              *
 *    ans  : ？？？？？l？？？O？？？？？？？？？M？？？A？？？M？？？？？？？？？M？？？？？f？[？^？？？？？？？？？？？？       *
 *******************************************************************************/
int I2C_ReceiveCheck() {
    int ans;

    ans = 0;
    if (rcv_flg != 0) { // ？？？M？？？？？？？？
        if ((SSPSTATbits.S == 0)&&(SSPSTATbits.P == 1)) { // ？？？？？？？？？？？？？？？？s？？？？？？？？？？
            ans = rcv_flg;
            rcv_flg = 0;
        }
    }
    return (ans);
}
